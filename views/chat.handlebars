<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <script src="/socket.io/socket.io.js"></script>
</head>
<body style="background-color: snow;">
	<topBar id="topBar"></topBar>
	<bottomBar id="bottombar"></bottomBar>
	<div class="container">
	<br>
		<div class="jumbotron">
			<h1 class="display-4">Send Message</h1>
			<br>
			<textarea id="message" class="form-control" placeholder="Your Message Here">
			</textarea>
			<br>
			<button id="send" onclick="buttonClicked()" class="btn btn-success">Send</button>
		</div>
		<div id="messages">
		
		</div>
	</div>

	<script>
   	var socket = io();

		window.onload = function() {
			$.get('/messages', (data) => {
				data.forEach(addMessages);
			})	
		}
		 
		function buttonClicked() {
      sendMessage({name: "{{name}}", message: $("#message").val()});
			document.getElementById('message').value = ""

      getMessages()
    }

    socket.on('message', addMessages)

    function addMessages(message) {
      $("#messages").append(`<h4> ${message.name} </h4> <p> ${message.message} </p>`)
    }

    function sendMessage(message) {
      $.post('/messages', message)
    }
	</script>

	<script src="https://code.jquery.com/jquery-3.4.1.js"
			integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
			crossorigin="anonymous">
	</script>

	<script type="riot/tag" src="/tags/topBar.html"></script>
	<script type="riot/tag" src="/tags/bottomBar.html"></script>
	<script>
			riot.mount("topBar", {    // this is basically client-side rendering 
			});
			riot.mount("bottomBar", {    // this is basically client-side rendering 
			});
	</script>
</body>
</html>
